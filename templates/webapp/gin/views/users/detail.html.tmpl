{{ define "users/detail.html" }}
{{ template "layout.html" . }}
{{ end }}

{{ define "content" }}
<div class="user-detail-page">
    <h2>{{.Title}}</h2>
    
    <div class="user-card">
        <h3>{{.User.Name}}</h3>
        <p><strong>ID:</strong> {{.User.ID}}</p>
        <p><strong>Email:</strong> {{.User.Email}}</p>
    </div>
    
    <div class="user-actions">
        <a href="/users" class="btn secondary">Back to Users</a>
        <button class="btn danger delete-user" data-id="{{.User.ID}}">Delete User</button>
    </div>
    
    <div class="user-edit-form">
        <h3>Edit User</h3>
        <form id="edit-user-form" class="user-form">
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" id="name" name="name" value="{{.User.Name}}" required>
            </div>
            
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" value="{{.User.Email}}" required>
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn primary">Update User</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle edit user form submission
    const form = document.getElementById('edit-user-form');
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const userId = "{{.User.ID}}";
        
        fetch('/users/' + userId, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name, email })
        })
        .then(response => response.json())
        .then(data => {
            alert('User updated successfully!');
            window.location.reload();
        })
        .catch(error => {
            alert('Error updating user: ' + error);
        });
    });
    
    // Handle delete button
    const deleteButton = document.querySelector('.delete-user');
    deleteButton.addEventListener('click', function() {
        const id = this.getAttribute('data-id');
        
        if (confirm('Are you sure you want to delete this user?')) {
            fetch('/users/' + id, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.status === 204) {
                    alert('User deleted successfully!');
                    window.location.href = '/users';
                } else {
                    throw new Error('Failed to delete user');
                }
            })
            .catch(error => {
                alert('Error deleting user: ' + error);
            });
        }
    });
});
</script>
{{ end }}
